### 容器
- 本库的主要目的在于实现常用的高级数据结构，称为***容器***，比如集合等，而非线性表等简单数据结构
- 实现的容器
	1. 集合（基于红黑树构造）
	2. 列表（基于线性表或链表，实现随机、顺序存取和堆栈、队列方式的存取）
	3. 优先级队列（基于线性表构造，支持16个优先级）
	4. 池（基于线性表和单链表构造）
	5. 哈希表（基于线性探测的三值哈希构造）
	6. 目录（基于树林和映射构造）
	7. 报表（基于二维线性表构造）
	8. 网络（基于有向加权图构造）
- 自定义结构类型`Container`，枚举类型`ContainerType`
```
// 容器结构
typedef struct {
	void *container;
	ContainerType type;
} Container, *Container_p;
// 容器类型的枚举
typedef enum {
	Set,
	Pool,
	HashTable,
	Content,
	Report,
	Network
} ContainerType;
```

### 元素
- 容器中存放的内容称为***元素***
- 为了实现与数据类型无关的容器，本库使用自定义类型`Element`作为所有容器元素的统一数据类型，并提供C语言基础数据类型的装箱和拆箱函数
```
typedef void *Element;
```
- 基础数据类型的装箱指将基础数据类型打包成`Element`类型的元素，拆箱值将元素转换回基本数据类型
- ***注意：装箱将动态分配内存，但拆箱时不会自动释放元素的内存空间，客户程序应在适当的时候使用标准库函数`free()`来释放装箱后生成的元素所占用的内存***
- `char, short, int, long, long long`五种数据类型及其无符号型装箱时转为`long long`，客户程序可以自行对拆箱结果进行类型强制转换
- `float, double, long double`三种数据类型装箱时转为`long double`，客户程序可以自行对拆箱结果进行类型强制转换，但有可能损失精度
- 增加自定义数据类型`string`
```
typedef char *string;
```
- 增加自定义数据类型`object`，用以存放任何类型的指针
```
typedef void *object;
```
- 容器元素的类型分为`Integer, Real, String, Object`四种，有枚举`ElementType`定义
```
typedef enum {
	Integer,
	Real,
	String,
	Object
} ElementType;
```
- 容器元素可以通过比较函数来进行比较，元素比较函数比较两个元素的大小，第一个元素大于第二个元素时返回一个小于0的整数，反之返回一个大于0的整数，相等时返回0
- 元素比较函数定义了指针类型，客户程序可以指定自定义的比较函数
```
typedef int (*CmpFunc)(const void *, const void *);
```
- 用户不指定自定义的比较函数时，容器使用其元素类型对应的默认比较函数进行元素比较，规则如下：
	- Integer: 比较实际的数值大小，返回-1, 0, 或1
	- Real: 比较实际的数值大小，返回-1, 0, 或1
	- String: 调用标准库函数`strcmp()`进行比较并返回其返回值
	- Object: 比较两个元素的地址，地址相同认为相等并返回0，否则认为不等，根据两者地址位置的先后返回-1或1

### 迭代器
- 容器除了自身特性决定的访问方式外还实现迭代访问元素的功能，不同容器迭代器的迭代算法不同但迭代器的客户程序接口则是统一的，部分容器不支持迭代，如Pool
- 迭代过程可以读取和删除元素，删除元素后迭代器将进入下一个迭代位置，读取或删除最后一个元素后一次迭代结束，再次访问返回NULL，再继续访问会从容器头部重新开始迭代。
- 一个容器可以同时获得多个迭代器，各个迭代器的迭代步骤互不干扰
- 迭代接口：
	- 获取容器的迭代器
	```
	Iterator it = it_create(Container_p container, int reverse);	// reverse == 0: 正向迭代; 非0值: 反向迭代，部分容器可能不支持反向迭代，对这类容器reserve值无意义
	```
	- 迭代读取元素
	```
	Element e;
	while ((e = it_next(it))) {
		// do something...
	}
	```
	- 迭代删除元素，删除的是上一次迭代得到的元素
	```
		Element e = it_next(it);
		it_remove();			// 删除容器中的元素e，迭代位置回到e的前驱，如果e是第一个元素则回到初始位置
		// free(e);			// 这里可以销毁元素e
	```
	- 迭代器销毁
	```
	it_destroy(it);				// 不再使用后必须及时销毁迭代器
	```

### 内存管理
- 容器、迭代器和装箱生成的元素在使用完毕后应由客户程序及时销毁
- 根据***谁分配，谁销毁***的原则，容器并不负责分配元素的内存空间，所以容器销毁时并不销毁其中的元素
- 除客户程序自行管理外，建议使用以下两个方法来进行容器中元素的销毁：
	- 使用容器或迭代器的`xx_remove()`函数删除元素时，元素会作为函数返回值返回，此时可以进行销毁
	- 使用容器的`xx_removeall(OnRemove onremove)`函数时，传入一个`typedef void (*OnRemove)(void *);`类型的函数来进行元素的统一销毁，典型地可以传入标准库函数`free()`

### 线程安全
- 所有实现的容器均为线程安全，但线程安全必然会影响部分性能，因此单线程环境时容器操作性能会比不提供线程安全时略有下降
- 迭代器使用Fast-Fail模式的线程安全，即在一个迭代器的迭代过程中，如果容器内容发生变化，则迭代立即失败，迭代器强制销毁
- 迭代过程全程加锁，一旦一个迭代器生成即获取自身的共享锁，直到迭代器被销毁，这个过程中其他线程无法使用这个迭代器，也即迭代器不能在线程间共享使用

### 字符串处理
- 支持UTF-8编码字符串的处理，支持以***字数***为基本长度单位进行处理
- 基本字符串处理功能包括：空串判断、空白符处理、子串查找、子串提取、按拼音顺序比较
- 高级字符串处理功能包括：分割、合并、子串替换、UTF-8和GB18030编码互换

### 通用算法
- 连续和离散存放两种存储形式下元素的快速排序
- 连续和离散存放两种存储形式下元素的插入排序
- MD5、SHA1算法
- 部分常用的经典哈希算法

### 错误处理
- 库函数使用统一的规则通过函数返回值向调用者发送错误信息
	- 返回值为整数类型的，-1表示出错
	- 返回值为指针类型的，包括Element，NULL表示出错
	- 在不会造成二义性的上下文中，部分函数返回-1或NULL并不代表出错，此类函数一般为不会导致错误发生的函数
	- 返回值为`void, size_t`或其他无法表示出错信息的函数，一般为此函数不会导致错误或此函数使用默认值静默地忽略错误
	- 存在特殊情况的参见头文件中函数声明处的注释
